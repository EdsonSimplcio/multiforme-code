<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Multiplayer Quadrados 2D</title>
  <style>
    body { margin:0; background:#111; }
    canvas { display:block; background:#222; }
    #controls {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: grid;
      grid-template-columns: 60px 60px 60px;
      grid-template-rows: 60px 60px 60px;
      gap: 5px;
      z-index: 1000;
    }
    #controls button {
      background: #0084ff;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 20px;
      cursor: pointer;
    }
    #controls .empty { background: transparent; cursor: default; }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <!-- Botões virtuais -->
  <div id="controls">
    <div class="empty"></div>
    <button id="up">⬆️</button>
    <div class="empty"></div>
    <button id="left">⬅️</button>
    <div class="empty"></div>
    <button id="right">➡️</button>
    <div class="empty"></div>
    <button id="down">⬇️</button>
    <div class="empty"></div>
  </div>

  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

  <script>
    const socket = io();

    let currentRoom = prompt("Digite o nome da sala:");
    let username = prompt("Digite seu nome:");
    let senha = prompt("Digite a senha da sala:");

    socket.emit("joinRoom", { room: currentRoom, password: senha, user: username });

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let players = {};
    let myPlayer = { x: 400, y: 300, color: "lime" };

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // desenha meu quadrado
      ctx.fillStyle = myPlayer.color;
      ctx.fillRect(myPlayer.x, myPlayer.y, 30, 30);

      // desenha outros jogadores
      for (let id in players) {
        const p = players[id];
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y, 30, 30);
      }

      requestAnimationFrame(draw);
    }

    function mover(key) {
      switch(key) {
        case "ArrowUp": myPlayer.y -= 10; break;
        case "ArrowDown": myPlayer.y += 10; break;
        case "ArrowLeft": myPlayer.x -= 10; break;
        case "ArrowRight": myPlayer.x += 10; break;
      }
      socket.emit("playerUpdate", { room: currentRoom, x: myPlayer.x, y: myPlayer.y, z: 0 });
    }

    window.addEventListener("keydown", (e) => mover(e.key));
    document.getElementById("up").onclick = () => mover("ArrowUp");
    document.getElementById("down").onclick = () => mover("ArrowDown");
    document.getElementById("left").onclick = () => mover("ArrowLeft");
    document.getElementById("right").onclick = () => mover("ArrowRight");

    socket.on("playerUpdate", (data) => {
      if (!players[data.id]) {
        players[data.id] = { x: data.x, y: data.y, color: "red" };
      }
      players[data.id].x = data.x;
      players[data.id].y = data.y;
    });

    socket.on("playerDisconnect", (id) => {
      delete players[id];
    });

    draw();
  </script>
</body>
</html>
